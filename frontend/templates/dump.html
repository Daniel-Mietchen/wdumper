{% extends "base.html" %}
{% block view %}info{% endblock view %}

{% block content %}
<h2>Dump {{n}}: {{ dump.title }}</h2>

{% if dump.done %}
<a href="{{dump.download_link}}">Download</a>
{% endif %}

<table>
    <tr class="table-label">
        <td>Created at</td>
        <td>{{ dump.created_at }} </td>
    </tr>
    {% if dump.run %}
    <tr>
        <td>Processing started at</td>
        <td>{{ dump.run.started_at }} </td>
    </tr>
    <tr>
        <td>Processing finished at</td>
        <td>{{ dump.run.finished_at }} </td>
    </tr>
    <tr>
        <td>Progress (processed items)</td>
        <td>{{ dump.run.count }}</td>
    </tr>
    {% endif %}

    <tr>
        <td>Zenodo</td>
        <td>
            {% if dump.zenodo_sandbox %}
            Sandbox DOI: <a href="https://sandbox.zenodo.org/record/{{dump.zenodo_sandbox.deposit_id}}">{{dump.zenodo_sandbox.doi}}</a>
            {% else %}
            <button class="upload" data-target="sandbox" data-dump-id="{{ dump.id }}">Upload to Sandbox</button>
            {% endif %}
            {% if dump.zenodo_release %}
            DOI: <a href="https://doi.org/{{dump.zenodo_release.doi}}">{{dump.zenodo_release.doi}}</a>
            {% else %}
            <button class="upload" data-target="release" data-dump-id="{{ dump.id }}">Upload to Release</button>
            {% endif %}
        </td>
    </tr>
</table>

<br>

<h3>Spec</h3>
<p>
    <code>
    <pre>
{{json.dumps(json.loads(dump.spec), indent=2)}}
    </pre>
    </code>
</p>

{% if dump.error_message %}
<h3>Error message</h3>
<code>
    <pre>
{{dump.error_message}}
    </pre>
</code>
{% endif %}

{% endblock %}
